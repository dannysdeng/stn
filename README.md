This code has not been tested nor optimized.
